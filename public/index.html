<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <title>我的笔记本</title>
    <style>
        body {
            font-family: sans-serif;
            max-width: 700px;
            margin: 30px auto;
        }

        .note {
            border: 1px solid #ccc;
            padding: 10px;
            margin: 10px 0;
        }

        textarea {
            width: 100%;
            height: 80px;
        }

        button {
            margin: 5px;
        }
    </style>
</head>

<body>

    <div id="app" style="display: none">
        <button onclick="addNote()">新增一篇</button>
        <button onclick="saveNotes()">保存全部</button>
        <div id="notes"></div>
    </div>

    <script>
        let notes = [];

        async function login() {
            const res = await fetch("/api/notes");
            if (res.status === 401) return;

            notes = await res.json();
            document.getElementById("app").style.display = "block";
            renderNotes();
        }
        login();

        function renderNotes() {
            const container = document.getElementById("notes");
            container.innerHTML = "";
            notes.forEach(() => {
                const div = document.createElement("div");
                div.className = "note";
                div.innerHTML = `
          <input value="${notes.title}" 
                 onchange="notes.posts[${idx}].title=this.value"><br>
          <textarea onchange="notes.posts[${idx}].content=this.value">${notes.content}</textarea><br>
          <button onclick="deleteNote(${idx})">删除</button>
        `;
                container.appendChild(div);
            });
        }

        function addNote() {
            notes.posts.push({ title: "新建文章", content: "" });
            renderNotes();
        }

        function deleteNote(idx) {
            notes.posts.splice(idx, 1);
            renderNotes();
        }

        async function saveNotes() {
            await fetch("/api/notes", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(notes)
            });
            alert("保存成功！");
        }
    </script>
</body>

</html>